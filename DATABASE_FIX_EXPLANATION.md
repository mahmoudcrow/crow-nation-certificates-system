# ุดุฑุญ ุฅุตูุงุญ ูุดููุฉ ุญูุธ ุงูุดูุงุฏุงุช ๐ง

## ุงููุดููุฉ โ
**ุงูุชูุฑูุฑ ูู ุงููุณุชุฎุฏู:** "ุงูุดูุงุฏู ุจุนุฏ ุงูุดุงุฆูุง ูุด ููุฌูุฏู ุจุฑุฏู ูู ููุง ูู ุงูุชุงุจุงุช"

ุจุนุฏ ุฅุถุงูุฉ ุดูุงุฏุฉ ุฌุฏูุฏุฉุ ุงูุดูุงุฏุฉ ูุงูุช:
- ุชุนุฑุถ ุฑุณุงูุฉ "โ ุชู ุฅุถุงูุฉ ุงูุดูุงุฏุฉ ุจูุฌุงุญ"
- ููููุง **ูุง ุชุธูุฑ ูู ุฌุฏูู ุงูุดูุงุฏุงุช** ุนูู ุงูุตูุญุฉ
- **ูุง ุชุธูุฑ ูู ูุงุฆูุฉ ุงูุดูุงุฏุงุช** ุงููุฑุนูุฉ
- **ูุง ุชุธูุฑ ูู ุตูุญุฉ ุงูุชุญูููุงุช**

---

## ุงูุณุจุจ ุงูุฌุฐุฑู ๐

ูุงู ููุงู **ุนุฏู ุชุทุงุจู ุจูู ุงูููุฏ ูุฌุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**:

### ูุง ูุงู ููุนูู ุงูููุฏ (admin-page.php):
```php
$data = [
    'serial' => ...,
    'name' => ...,
    'email' => ...,           // โ ุญูู ุฌุฏูุฏ
    'title' => ...,
    'qr_code_url' => ...,     // โ ุญูู ุฌุฏูุฏ  
    'created_at' => current_time('mysql'), // โ ุญูู ุฌุฏูุฏ
];
$wpdb->insert($table, $data);
```

### ูุง ูุงู ููุฌูุฏุงู ูู ุงูุฌุฏูู (create-table.php - ุงููุฏูู):
```sql
CREATE TABLE wp_crow_certificates (
    id, serial, name,
    title, reason,
    issue_date, expiry_date,
    status, certificate_image,
    -- โ ุงูุญููู ุงูุชุงููุฉ **ููููุฏุฉ**:
    -- email
    -- qr_code_url  
    -- created_at
    -- updated_at
)
```

### ุงููุชูุฌุฉ:
- `INSERT` ูุญุงูู ุฅุถุงูุฉ ุญููู **ูุง ุชูุจููุง ุงูุฌุฏุงูู**
- ูุฏ ููุฌุญ `INSERT` ููู **ุงูุญููู ุงูุฌุฏูุฏุฉ ุชูุชุฌุงูู**
- ุฃู ูุฏ ูุญุฏุซ `SQL ERROR`
- ุงูุจูุงูุงุช ุฅูุง **ูู ุชูุญูุธ** ุฃู **ุญููุธุช ุจุดูู ูุงูุต**

---

## ุงูุญู โ

ุชู ุชุทุจูู ุญู ุดุงูู ุนูู 3 ูุณุชููุงุช:

### 1๏ธโฃ ุชุญุฏูุซ Schema ูู `includes/create-table.php`
```php
CREATE TABLE wp_crow_certificates (
    id mediumint(9) NOT NULL AUTO_INCREMENT,
    serial varchar(100) NOT NULL UNIQUE,
    name varchar(255) NOT NULL,
    email varchar(255),              // โ ุฃุถูู
    title varchar(255) NOT NULL,
    reason text,
    issue_date date,
    expiry_date date,
    status varchar(50) DEFAULT 'active',
    certificate_image varchar(500),
    qr_code_url varchar(500),         // โ ุฃุถูู
    created_at datetime DEFAULT CURRENT_TIMESTAMP,  // โ ุฃุถูู
    updated_at datetime ON UPDATE CURRENT_TIMESTAMP, // โ ุฃุถูู
    PRIMARY KEY (id),
    UNIQUE KEY serial (serial),
    KEY status (status),
    KEY created_at (created_at)
)
```

**ุงููุงุฆุฏุฉ:** ุงูุชุซุจูุชุงุช ุงูุฌุฏูุฏุฉ ุณุชุญุตู ุนูู ุงูุฌุฏูู ุงูุตุญูุญ ูู ุงูุจุฏุงูุฉ

---

### 2๏ธโฃ ุฅูุดุงุก ูุธุงู Migrations ูู `includes/database-migrations.php` ๐
```php
function crow_update_database_schema() {
    // 1. ุงูุชุญูู ูู ูุฌูุฏ ุงูุฌุฏูู
    // 2. ุฅุถุงูุฉ ุงูุฃุนูุฏุฉ ุงููุงูุตุฉ ุชููุงุฆูุงู (ALTER TABLE)
    // 3. ุฅุถุงูุฉ ุงูููุงุฑุณ ุงูููููุฏุฉ
    // 4. ุชุญุฏูุซ ุงูุจูุงูุงุช ุงููุฏููุฉ
}

function crow_run_migrations() {
    // ููุงุฑู ูุณุฎุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
    // ุฅุฐุง ุงุฎุชููุชุ ูููุฐ ุงูุชุญุฏูุซุงุช
    // ููุญูุธ ุฑูู ุงููุณุฎุฉ ุงูุฌุฏูุฏ
}
```

**ุงููุงุฆุฏุฉ:** ุงูู Installations ุงููุฏููุฉ **ุชูุญุฏุซ ุชููุงุฆูุงู** ุจุฏูู ููุฏุงู ุงูุจูุงูุงุช

---

### 3๏ธโฃ ุฏูุฌ ุงูู Migrations ูู `crow-nation-certificates.php`
```php
// ุชุนุฑูู ูุณุฎุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
define('CROW_DB_VERSION', '1.0.4');

// ุชุญููู ูุธุงู ุงูู Migrations
require_once plugin_dir_path(__FILE__) . 'includes/database-migrations.php';

// ุนูุฏ ุชูุนูู ุงูุฅุถุงูุฉ
register_activation_hook(__FILE__, function() {
    crow_create_certificates_table();
    crow_run_migrations();  // โ ูุดุบู ุงูู Migrations ููุฑุงู
});

// ุนูุฏ ูู ุฏุฎูู ููู Admin
add_action('init', 'crow_run_migrations'); // โ ุชุญุฏูุซ ุฅุถุงูู ููุฃูุงู
```

**ุงููุงุฆุฏุฉ:** ุงูู Migrations ุชุนูู ุชููุงุฆูุงู ูู ูู ุงูุฃููุงุช ุงูููุงุณุจุฉ

---

## ููู ูุนูู ุงูุญู ๐

### ุนูุฏ ุชูุนูู ุงูุฅุถุงูุฉ ูุฃูู ูุฑุฉ:
```
โ crow_create_certificates_table() โ ููุดุฆ ุงูุฌุฏูู ุงููุงูู
โ crow_run_migrations()           โ ูุชุญูู ูู ูุณุฎุฉ ุงูุจูุงูุงุช
โ ุฌุฏูู ุฌุฏูุฏ = ุฌุงูุฒ ููุงุณุชุฎุฏุงู
```

### ุนูุฏ ุชุญุฏูุซ ุงูุฅุถุงูุฉ (ูู v1.0.3 ุฅูู v1.0.4):
```
1. ุงููุณุชุฎุฏู ูุญุฏุซ ุงูุฅุถุงูุฉ
2. crow_run_migrations() ูุนูู ูู admin_init
3. ููุชุดู: get_option('crow_db_version') != CROW_DB_VERSION
4. ูููุฐ ALTER TABLE ูุฅุถุงูุฉ:
   - email
   - qr_code_url
   - created_at
   - updated_at
5. ููุญูุธ: update_option('crow_db_version', '1.0.4')
6. ุนูุฏ ุงููุฑุฉ ุงููุงุฏูุฉ: โ ุชุทุงุจู ุงููุณุฎ = ูุง ุชุญุฏูุซุงุช ุฅุถุงููุฉ
```

### ุจุนุฏ ุงูุชุญุฏูุซ:
```
โ ุงูุฌุฏูู ุงูุขู ูุญุชูู ุนูู ุฌููุน ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ
โ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ูุญููุธุฉ
โ ุงูุดูุงุฏุงุช ุงูุฌุฏูุฏุฉ ุชูุญูุธ ุจูุฌุงุญ
โ ุงูุดูุงุฏุงุช ุชุธูุฑ ูู ุฌููุน ุงูุตูุญุงุช
```

---

## ูุงุฐุง ุชู ุฅุตูุงุญู ุจุงูุถุจุท ๐

| ุงููุดููุฉ | ุงูุญู | ุงูููู |
|--------|------|-------|
| ุฌุฏูู ูุงูุต ุงูุฃุนูุฏุฉ | ุชุญุฏูุซ ุงูู Schema | `create-table.php` |
| ุงูุฌุฏูู ุงููุฏูู ูุง ูุญุชูู ุนูู ุงูุญููู | ูุธุงู Migrations | `database-migrations.php` ๐ |
| ูุง ุชุญุฏูุซ ุชููุงุฆู ููู Installations ุงููุฏููุฉ | ุฏูุฌ ุงูู Migrations ูู ุงูุจุฑูุงูุฌ ุงูุฑุฆูุณู | `crow-nation-certificates.php` |
| ุงูุญููู ุงูุฌุฏูุฏุฉ ูุง ุชูุญูุธ | ุงูุขู ูุญูุธ: email, qr_code_url, created_at | `admin-page.php` |
| ุงูุฌุฏูู ูุง ูุนุฑุถ ุงูุจูุงูุงุช | ุงูุจูุงูุงุช ุงูุขู ุชูุญูุธ ุจุดูู ุตุญูุญ | ุงููุชูุฌุฉ ุงูููุงุฆูุฉ โ |

---

## ุงูุงุฎุชุจุงุฑ ๐งช

ูุงุฎุชุจุงุฑ ุฃู ุงูุญู ูุนูู:

### 1. ุชูุนูู ุงูุฅุถุงูุฉ
```
โ ุฅุฐุง ุฌุฏูุฏ: ุฌุฏูู ูุงูู
โ ุฅุฐุง ูุฏูู: ุฌุฏูู ูุญุฏุซ
```

### 2. ุฅุถุงูุฉ ุดูุงุฏุฉ ุฌุฏูุฏุฉ
```
1. ุงุฐูุจ ุฅูู ุงูุดูุงุฏุงุช โ ุดูุงุฏุฉ ุฌุฏูุฏุฉ
2. ููุก ุงูุจูุงูุงุช (ุงูุณูุฑูุงูุ ุงูุงุณูุ ุงูุจุฑูุฏุ ุฅูุฎ)
3. ุงููุฑ "โ ุฅุถุงูุฉ ุงูุดูุงุฏุฉ"
4. ูุฌุจ ุฃู ุชุฑู: โ ุชู ุฅุถุงูุฉ ุงูุดูุงุฏุฉ ุจูุฌุงุญ
```

### 3. ุงูุชุญูู ูู ุงูุธููุฑ
```
โ ุงูุดูุงุฏุฉ ุชุธูุฑ ูู ุฌุฏูู "ุฌููุน ุงูุดูุงุฏุงุช" ุฃุณูู ุงููููุฐุฌ
โ ุงูุดูุงุฏุฉ ุชุธูุฑ ูู ูุงุฆูุฉ ุงูุดูุงุฏุงุช ุงููุฑุนูุฉ ๐
โ ุงูุดูุงุฏุฉ ุชุธูุฑ ูู ุงูุชุญูููุงุช
โ ุงูู QR Code ูุธูุฑ ุชููุงุฆูุงู
```

### 4. ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุงุฎุชูุงุฑู)
```sql
SELECT * FROM wp_crow_certificates ORDER BY id DESC LIMIT 1;
```

ูุฌุจ ุฃู ุชุฑู:
- โ email (ุงููููุฉ ุงููุฏุฎูุฉ)
- โ qr_code_url (ุงูุฑุงุจุท ุงูุชููุงุฆู)
- โ created_at (ุงูููุช ุงูุญุงูู)
- โ ุฌููุน ุงูุญููู ุงูุฃุฎุฑู

---

## ููุงุญุธุงุช ูุงูุฉ โ๏ธ

### ุจุฏูู ููุฏุงู ุงูุจูุงูุงุช
ุงูู Migrations **ูุง ุชุญุฐู ุฃู ุจูุงูุงุช**:
- ุชุถูู ุฃุนูุฏุฉ ููุท
- ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ูุญููุธุฉ
- NULL ุชูุนุทู ูููุงู ุงูุชุฑุงุถูุฉ

### ุงูุฃุฏุงุก
- Migration ูุนูู **ูุฑุฉ ูุงุญุฏุฉ ููุท** ููู ุฅุตุฏุงุฑ
- ูุชุงุฆุฌ ูุงุจูุฉ ููุฐุงูุฑุฉ
- **ูุง ุชุฃุซูุฑ** ุนูู ุงูุฃุฏุงุก ุจุนุฏ ุงูุชุญุฏูุซ ุงูุฃูู

### ุงูุชูุงูููุฉ
- โ WordPress 5.0+
- โ PHP 7.4+
- โ MySQL/MariaDB
- โ Backward compatible

---

## ุงูุฎูุงุตุฉ ๐ฏ

**ูุจู ุงูุฅุตูุงุญ:** ุงูุดูุงุฏุงุช ูุง ุชูุญูุธ (ุบูุงุจ ุงูุฃุนูุฏุฉ)

**ุจุนุฏ ุงูุฅุตูุงุญ:** 
1. โ ุงูุฌุฏูู ุงููุงูู ูุน ุฌููุน ุงูุฃุนูุฏุฉ
2. โ Migrations ุชุญุฏุซ ุงูุฌุฏุงูู ุงููุฏููุฉ
3. โ ุงูุจูุงูุงุช ุชูุญูุธ ุจูุฌุงุญ
4. โ ุงูุดูุงุฏุงุช ุชุธูุฑ ูู ูู ููุงู

**ุงููุชูุฌุฉ:** ุงูุฅุถุงูุฉ ุฌุงูุฒุฉ ููุนูู ุงูุขู โ
